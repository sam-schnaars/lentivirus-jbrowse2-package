"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.default = FeatureDetails;
const react_1 = __importDefault(require("react"));
const ErrorBoundary_1 = require("@jbrowse/core/ui/ErrorBoundary");
const material_1 = require("@mui/material");
// locals
const util_1 = require("../../util");
const ui_1 = require("../../ui");
const util_2 = require("./util");
const SequenceFeatureDetails_1 = __importDefault(require("../SequenceFeatureDetails"));
const Attributes_1 = __importDefault(require("./Attributes"));
const BaseCard_1 = __importDefault(require("./BaseCard"));
const CoreDetails_1 = __importDefault(require("./CoreDetails"));
// coreDetails are omitted in some circumstances
const coreDetails = [
    'name',
    'start',
    'end',
    'strand',
    'refName',
    'description',
    'type',
];
function FeatureDetails(props) {
    const { omit = [], model, feature, depth = 0 } = props;
    const { maxDepth } = model;
    const { mate, name = '', id = '', type = '', subfeatures, uniqueId } = feature;
    const pm = (0, util_1.getEnv)(model).pluginManager;
    const session = (0, util_1.getSession)(model);
    const ExtraPanel = pm.evaluateExtensionPoint('Core-extraFeaturePanel', null, {
        session,
        feature,
        model,
    });
    const m = mate;
    return (react_1.default.createElement(BaseCard_1.default, { title: (0, util_2.generateTitle)(name, id, type) },
        react_1.default.createElement(material_1.Typography, null, "Core details"),
        react_1.default.createElement(CoreDetails_1.default, { ...props }),
        m ? (react_1.default.createElement(react_1.default.Fragment, null,
            react_1.default.createElement(material_1.Divider, null),
            react_1.default.createElement(material_1.Typography, null, "Mate details"),
            react_1.default.createElement(CoreDetails_1.default, { ...props, feature: {
                    ...m,
                    start: m.start,
                    end: m.end,
                    refName: m.refName,
                    uniqueId: `${uniqueId}-mate`,
                } }))) : null,
        react_1.default.createElement(material_1.Divider, null),
        react_1.default.createElement(material_1.Typography, null, "Attributes"),
        react_1.default.createElement(Attributes_1.default, { attributes: feature, ...props, omit: omit, omitSingleLevel: coreDetails }),
        react_1.default.createElement(ErrorBoundary_1.ErrorBoundary, { FallbackComponent: e => react_1.default.createElement(ui_1.ErrorMessage, { error: e.error }) },
            react_1.default.createElement(SequenceFeatureDetails_1.default, { ...props })),
        ExtraPanel ? (react_1.default.createElement(react_1.default.Fragment, null,
            react_1.default.createElement(material_1.Divider, null),
            react_1.default.createElement(BaseCard_1.default, { title: ExtraPanel.name },
                react_1.default.createElement(ExtraPanel.Component, { ...props })))) : null,
        depth < maxDepth && (subfeatures === null || subfeatures === void 0 ? void 0 : subfeatures.length) ? (react_1.default.createElement(BaseCard_1.default, { title: "Subfeatures", defaultExpanded: depth < 1 }, subfeatures.map((sub, idx) => (react_1.default.createElement(FeatureDetails, { key: JSON.stringify(sub), feature: {
                ...sub,
                uniqueId: `${uniqueId}_${idx}`,
            }, model: model, depth: depth + 1 }))))) : null));
}
