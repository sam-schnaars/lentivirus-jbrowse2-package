"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.default = SVGRuler;
const react_1 = __importDefault(require("react"));
const util_1 = require("@jbrowse/core/util");
const material_1 = require("@mui/material");
// locals
const util_2 = require("../util");
const SVGRegionSeparators_1 = __importDefault(require("./SVGRegionSeparators"));
function Ruler({ start, end, bpPerPx, reversed = false, major = true, minor = true, hideText = false, }) {
    const ticks = (0, util_2.makeTicks)(start, end, bpPerPx, major, minor);
    const theme = (0, material_1.useTheme)();
    const c = (0, util_1.stripAlpha)(theme.palette.text.secondary);
    return (react_1.default.createElement(react_1.default.Fragment, null,
        ticks.map(tick => {
            const x = (reversed ? end - tick.base : tick.base - start) / bpPerPx;
            return (react_1.default.createElement("line", { key: `tick-${tick.base}`, x1: x, x2: x, y1: 0, y2: tick.type === 'major' ? 6 : 4, strokeWidth: 1, stroke: c }));
        }),
        !hideText
            ? ticks
                .filter(tick => tick.type === 'major')
                .map(tick => {
                const x = (reversed ? end - tick.base : tick.base - start) / bpPerPx;
                return (react_1.default.createElement("text", { key: `label-${tick.base}`, x: x - 3, y: 7 + 11, fontSize: 11, fill: c }, (0, util_1.getTickDisplayStr)(tick.base + 1, bpPerPx)));
            })
            : null));
}
function SVGRuler({ model, fontSize, }) {
    const { dynamicBlocks: { contentBlocks }, offsetPx: viewOffsetPx, bpPerPx, } = model;
    const renderRuler = contentBlocks.length < 5;
    const theme = (0, material_1.useTheme)();
    const c = (0, util_1.stripAlpha)(theme.palette.text.primary);
    return (react_1.default.createElement(react_1.default.Fragment, null,
        react_1.default.createElement(SVGRegionSeparators_1.default, { model: model, height: 30 }),
        contentBlocks.map(block => {
            const { start, end, key, reversed, offsetPx, refName, widthPx } = block;
            const offset = offsetPx - viewOffsetPx;
            const clipid = `clip-${key}`;
            return (react_1.default.createElement("g", { key: key },
                react_1.default.createElement("defs", null,
                    react_1.default.createElement("clipPath", { id: clipid },
                        react_1.default.createElement("rect", { x: 0, y: 0, width: widthPx, height: 100 }))),
                react_1.default.createElement("g", { transform: `translate(${offset} 0)` },
                    react_1.default.createElement("g", { clipPath: `url(#${clipid})` },
                        react_1.default.createElement("text", { x: 4, y: fontSize, fontSize: fontSize, fill: c }, refName),
                        react_1.default.createElement("g", { transform: "translate(0 20)" },
                            react_1.default.createElement(Ruler, { hideText: !renderRuler, start: start, end: end, bpPerPx: bpPerPx, reversed: reversed }))))));
        })));
}
